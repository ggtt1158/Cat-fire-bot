<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat Fire - Earn Money</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Monetag SDK -->
    <script src='//libtl.com/sdk.js' data-zone='9937367' data-sdk='show_9937367' async></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #FF6B35;
            --secondary-color: #F7931E;
            --success-color: #4CAF50;
            --danger-color: #f44336;
            --warning-color: #ff9800;
            --dark-bg: #1a1a2e;
            --card-bg: #16213e;
            --text-primary: #ffffff;
            --text-secondary: #b8b8b8;
            --border-color: #2d3561;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: var(--text-primary);
            min-height: 100vh;
            /* ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶ì ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ‡¶¨‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶Ø‡¶æ‡¶°‡¶ø‡¶Ç */
            padding-bottom: 140px;
        }

        /* VPN Warning Modal */
        .vpn-warning { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); z-index: 10000; justify-content: center; align-items: center; }
        .vpn-warning.active { display: flex; }
        .vpn-content { background: var(--card-bg); padding: 30px; border-radius: 15px; text-align: center; max-width: 400px; margin: 20px; border: 2px solid var(--danger-color); }
        .vpn-icon { font-size: 60px; color: var(--danger-color); margin-bottom: 20px; }
        .vpn-content h2 { color: var(--danger-color); margin-bottom: 15px; }
        .vpn-content p { color: var(--text-secondary); margin-bottom: 20px; line-height: 1.6; }

        /* Welcome Modal */
        .welcome-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 9999; justify-content: center; align-items: center; }
        .welcome-modal.active { display: flex; }
        .welcome-content { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); padding: 40px; border-radius: 20px; text-align: center; max-width: 400px; margin: 20px; animation: slideIn 0.5s ease; }
        @keyframes slideIn { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .welcome-content h2 { font-size: 28px; margin-bottom: 15px; }
        .welcome-content p { font-size: 16px; margin-bottom: 25px; line-height: 1.6; }
        .welcome-btn { background: white; color: var(--primary-color); border: none; padding: 12px 40px; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer; transition: transform 0.2s; }
        .welcome-btn:hover { transform: scale(1.05); }

        /* Loading Screen */
        .loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--dark-bg); display: flex; justify-content: center; align-items: center; z-index: 9998; }
        .loading-screen.hidden { display: none; }
        .loader { width: 50px; height: 50px; border: 5px solid var(--border-color); border-top: 5px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Header */
        .header { background: var(--card-bg); padding: 20px; text-align: center; border-bottom: 2px solid var(--border-color); }
        .header h1 { font-size: 24px; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .user-info { display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 10px; font-size: 14px; color: var(--text-secondary); }

        /* Balance Card */
        .balance-card { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); margin: 20px; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(255, 107, 53, 0.3); }
        .balance-label { font-size: 14px; opacity: 0.9; margin-bottom: 10px; }
        .balance-amount { font-size: 48px; font-weight: bold; margin-bottom: 20px; }
        .balance-actions { display: flex; gap: 10px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: white; color: var(--primary-color); }
        .btn-secondary { background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); }

        /* Content & Tasks */
        .container { padding: 20px; }
        .task-section { margin-bottom: 30px; }
        .section-title { font-size: 20px; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .section-icon { font-size: 24px; }
        .task-card { background: var(--card-bg); border-radius: 15px; padding: 20px; margin-bottom: 15px; border: 1px solid var(--border-color); transition: all 0.3s; }
        .task-card:hover { transform: translateY(-3px); box-shadow: 0 5px 20px rgba(255, 107, 53, 0.2); }
        .task-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .task-title { font-size: 18px; font-weight: bold; }
        .task-reward { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); padding: 5px 15px; border-radius: 20px; font-weight: bold; }
        .task-description { color: var(--text-secondary); margin-bottom: 15px; line-height: 1.5; }
        .task-progress { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 14px; color: var(--text-secondary); }
        .progress-bar { width: 100%; height: 8px; background: var(--dark-bg); border-radius: 10px; overflow: hidden; margin-bottom: 15px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); transition: width 0.3s; }
        .task-btn { width: 100%; padding: 12px; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .task-btn.active { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; }
        .task-btn.completed { background: var(--success-color); color: white; cursor: not-allowed; }
        .task-btn.disabled, .task-btn:disabled { background: var(--border-color); color: var(--text-secondary); cursor: not-allowed; }

        /* Bottom Navigation */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--card-bg); border-top: 2px solid var(--border-color); display: flex; justify-content: space-around; padding: 10px 0; z-index: 1000; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 5px; padding: 10px; cursor: pointer; transition: all 0.3s; border: none; background: transparent; color: var(--text-secondary); }
        .nav-item.active { color: var(--primary-color); }
        .nav-icon { font-size: 24px; }
        .nav-label { font-size: 12px; }

        /* Pages */
        .page { display: none; }
        .page.active { display: block; }
        
        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 9999; justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content { background: var(--card-bg); padding: 30px; border-radius: 20px; max-width: 400px; margin: 20px; text-align: center; }
        .modal-title { font-size: 24px; margin-bottom: 15px; }
        .modal-text { color: var(--text-secondary); margin-bottom: 20px; line-height: 1.6; }
        .modal-actions { display: flex; gap: 10px; }

        /* Notifications */
        .notification { position: fixed; top: 20px; right: 20px; background: var(--card-bg); padding: 15px 20px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3); z-index: 10002; animation: slideInRight 0.3s ease; max-width: 300px; }
        @keyframes slideInRight { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .notification.success { border-left: 4px solid var(--success-color); }
        .notification.error { border-left: 4px solid var(--danger-color); }
        .notification.warning { border-left: 4px solid var(--warning-color); }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loader"></div>
    </div>

    <!-- VPN Warning -->
    <div class="vpn-warning" id="vpnWarning">
        <!-- VPN content as before -->
    </div>

    <!-- Welcome Modal -->
    <div class="welcome-modal" id="welcomeModal">
        <!-- Welcome content as before -->
    </div>

    <!-- Header -->
    <div class="header">
        <h1>üî• Cat Fire</h1>
        <div class="user-info">
            <span id="userName">Loading...</span>
            <span>‚Ä¢</span>
            <span id="userId">ID: ...</span>
        </div>
    </div>

    <!-- Home Page -->
    <div class="page active" id="homePage">
        <!-- Balance Card -->
        <div class="balance-card">
            <!-- Balance content as before -->
        </div>

        <div class="container">
            <!-- Daily Tasks Section -->
            <div class="task-section">
                <h2 class="section-title">
                    <span class="section-icon">üìã</span>
                    ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï
                </h2>

                <!-- Monetag Ad Task -->
                <div class="task-card">
                    <div class="task-header">
                        <div class="task-title">üì∫ Rewarded ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</div>
                        <div class="task-reward">$<span id="monetagReward">0.05</span></div>
                    </div>
                    <div class="task-description">
                        ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶™‡ßá‡¶§‡ßá ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
                    </div>
                    <div class="task-progress">
                        <span>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø</span>
                        <span><span id="monetagCount">0</span>/<span id="monetagLimit">10</span></span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="monetagProgress" style="width: 0%"></div>
                    </div>
                    <button class="task-btn active" id="monetagBtn" onclick="watchMonetagAd()">
                        ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
                    </button>
                </div>
                 <!-- Other tasks as before -->
            </div>
        </div>
    </div>

    <!-- Other Pages (Withdraw, Referral, Profile) -->
    <!-- ... their HTML structure remains the same ... -->
    
    <!-- Real Banner Ad Container -->
    <div id="banner-ad-container" style="position: fixed; bottom: 70px; width: 100%; height: auto; display: flex; justify-content: center; align-items: center; z-index: 1001;">
        <!-- Monetag SDK will inject the banner ad here -->
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <!-- Nav items as before -->
    </div>

    <!-- Modals -->
    <div class="modal" id="taskModal">
        <!-- Modal content as before -->
    </div>

 <script>
    // Firebase Configuration
    const firebaseConfig = {
        apiKey: "AIzaSyA7vbuDVd49qNePXsNCJrsMVmj-LCSH3R8",
        authDomain: "cat-fire-bot.firebaseapp.com",
        databaseURL: "https://cat-fire-bot-default-rtdb.firebaseio.com",
        projectId: "cat-fire-bot",
        storageBucket: "cat-fire-bot.firebasestorage.app",
        messagingSenderId: "320717959791",
        appId: "1:320717959791:web:8a6d191972cf263a7d939a"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const tg = window.Telegram.WebApp;
    tg.expand();

    let userData = null;
    let adminSettings = null;
    const adZoneId = 9937367; // Your Monetag Zone ID

    // Initialize App
    async function initApp() {
        // ... (VPN check and user auth logic remains the same)

        try {
            const telegramUser = tg.initDataUnsafe?.user;
            if (!telegramUser) {
                showNotification('‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø', 'error');
                document.getElementById('loadingScreen').classList.add('hidden');
                return;
            }

            await authenticateUser(telegramUser);
            await loadAdminSettings();
            await loadUserData();
            
            updateUI();
            
            // Start ad functionalities
            initializeBannerAd();
            setInterval(showInterstitialAd, 60000); // 1 minute interval

            document.getElementById('loadingScreen').classList.add('hidden');
        } catch (error) {
            console.error('[v0] Init error:', error);
            showNotification('‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§', 'error');
            document.getElementById('loadingScreen').classList.add('hidden');
        }
    }

    // --- ADVERTISEMENT FUNCTIONS ---

    // 1. Banner Ad
    function initializeBannerAd() {
        console.log("Initializing Banner Ad...");
        // Monetag SDK usually finds a container and places the ad.
        // We'll create a banner ad spot.
        if (typeof TL !== 'undefined' && TL.ads) {
            TL.ads.show({
                zone: adZoneId,
                type: 'banner',
                container: 'banner-ad-container',
                callbacks: {
                    onShow: () => console.log('Banner ad shown'),
                    onError: (e) => console.error('Banner ad error', e)
                }
            });
        } else {
            console.warn("Monetag SDK (TL) not found for banner.");
        }
    }

    // 2. Interstitial Ad
    async function showInterstitialAd() {
        if (!userData || !adminSettings) return;

        // Reload user data to get the latest count
        const userDoc = await db.collection('users').doc(userData.telegramId).get();
        const currentInterstitialCount = userDoc.data().dailyTasks.interstitial.count || 0;

        if (currentInterstitialCount < 10) {
            console.log(`Showing interstitial ad, count: ${currentInterstitialCount}`);
            
            if (typeof TL !== 'undefined' && TL.ads) {
                TL.ads.show({
                    zone: adZoneId,
                    type: 'interstitial',
                    callbacks: {
                        onShow: async () => {
                            console.log('Interstitial ad shown');
                             await db.collection('users').doc(userData.telegramId).update({
                                'dailyTasks.interstitial.count': firebase.firestore.FieldValue.increment(1)
                            });
                            // No reward for interstitial
                        },
                        onError: (e) => console.error('Interstitial ad error', e)
                    }
                });
            } else {
                 console.warn("Monetag SDK (TL) not found for interstitial.");
            }
        } else {
            console.log('Interstitial ad daily limit reached.');
        }
    }

    // 3. Rewarded Ad
    async function watchMonetagAd() {
        if (userData.dailyTasks.monetag.count >= adminSettings.monetagLimit) {
            showNotification('‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑', 'warning');
            return;
        }

        const monetagBtn = document.getElementById('monetagBtn');
        monetagBtn.disabled = true;
        monetagBtn.textContent = '‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';

        if (typeof TL !== 'undefined' && TL.ads) {
             TL.ads.show({
                zone: adZoneId,
                type: 'reward', // Assuming 'reward' is the type for rewarded ads
                callbacks: {
                    onReward: async (reward) => {
                        console.log('Ad rewarded!', reward);
                        const rewardAmount = adminSettings.monetagReward;
                        
                        await db.collection('users').doc(userData.telegramId).update({
                            balance: firebase.firestore.FieldValue.increment(rewardAmount),
                            taskEarnings: firebase.firestore.FieldValue.increment(rewardAmount),
                            'dailyTasks.monetag.count': firebase.firestore.FieldValue.increment(1)
                        });

                        await loadUserData();
                        updateUI();
                        showNotification(`$${rewardAmount.toFixed(2)} ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`, 'success');
                    },
                    onClose: () => {
                        console.log('Rewarded ad closed');
                        monetagBtn.disabled = false;
                        monetagBtn.textContent = '‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®';
                    },
                    onError: (e) => {
                        console.error('Rewarded ad error', e);
                        showNotification('‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá', 'error');
                        monetagBtn.disabled = false;
                        monetagBtn.textContent = '‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®';
                    }
                }
            });
        } else {
            showNotification('‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® SDK ‡¶≤‡ßã‡¶° ‡¶π‡ßü‡¶®‡¶ø', 'error');
            monetagBtn.disabled = false;
            monetagBtn.textContent = '‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®';
            console.warn("Monetag SDK (TL) not found for rewarded ad.");
        }
    }

    // --- CORE APP LOGIC (abbreviated for clarity) ---
    async function authenticateUser(telegramUser) { /* ... as before ... */ }
    async function loadAdminSettings() { /* ... as before ... */ }
    async function loadUserData() {
        const telegramUser = tg.initDataUnsafe?.user;
        if (!telegramUser) return;
        const userId = telegramUser.id.toString();
        const userDoc = await db.collection('users').doc(userId).get();
        if (userDoc.exists) {
            userData = userDoc.data();
            const today = new Date().toDateString();
            let needsUpdate = false;
            if (!userData.dailyTasks.interstitial || userData.dailyTasks.interstitial.lastReset !== today) {
                userData.dailyTasks.interstitial = { count: 0, lastReset: today };
                needsUpdate = true;
            }
            if (needsUpdate) {
                await db.collection('users').doc(userId).update({ 'dailyTasks.interstitial': userData.dailyTasks.interstitial });
            }
        }
         /* ... rest of the function remains the same ... */
    }
    function updateUI() { /* ... as before ... */ }
    function showNotification(message, type = 'success') { /* ... as before ... */ }

    // Initialize app on load
    window.addEventListener('load', initApp);
</script>
        
</body>
</html>


